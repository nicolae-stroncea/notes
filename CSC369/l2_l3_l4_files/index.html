



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Files and File Systems - UofT courses</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#files-and-file-systems" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="UofT courses" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              UofT courses
            </span>
            <span class="md-header-nav__topic">
              
                Files and File Systems
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/nicolae-stroncea/notes/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="UofT courses" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    UofT courses
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/nicolae-stroncea/notes/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      CSC309
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        CSC309
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC309/" title="Communication and Protocols" class="md-nav__link">
      Communication and Protocols
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC309/http/" title="The World Wide Web and HTTP" class="md-nav__link">
      The World Wide Web and HTTP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC309/lec3/" title="Lec3" class="md-nav__link">
      Lec3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC309/midterm_preparation/" title="Midterm Preparation" class="md-nav__link">
      Midterm Preparation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      CSC343
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        CSC343
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/" title="Welcome to MkDocs" class="md-nav__link">
      Welcome to MkDocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/ddl/" title="Data Definition Language(DDL)" class="md-nav__link">
      Data Definition Language(DDL)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/relational_algebra/" title="Relational Algebra" class="md-nav__link">
      Relational Algebra
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/schema/" title="Schemas" class="md-nav__link">
      Schemas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/sql_dml_1/" title="Data Manipulation Language(DML)" class="md-nav__link">
      Data Manipulation Language(DML)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/sql_dml_2/" title="Outer Joins" class="md-nav__link">
      Outer Joins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/subqueries/" title="Subqueries" class="md-nav__link">
      Subqueries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      CSC369
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        CSC369
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l10_synchronization/" title="Synchronization" class="md-nav__link">
      Synchronization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l11_locks/" title="Locks" class="md-nav__link">
      Locks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l12_conditional_variables/" title="Conditional Variables" class="md-nav__link">
      Conditional Variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l13_semaphores/" title="Semaphores" class="md-nav__link">
      Semaphores
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l14_deadlocks/" title="Deadlock" class="md-nav__link">
      Deadlock
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Files and File Systems
      </label>
    
    <a href="./" title="Files and File Systems" class="md-nav__link md-nav__link--active">
      Files and File Systems
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#top-requirements-for-an-os" class="md-nav__link">
    Top requirements for an OS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-systems" class="md-nav__link">
    File Systems
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-operations" class="md-nav__link">
    File Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directories" class="md-nav__link">
    Directories
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure" class="md-nav__link">
    Directory Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directory-implementation" class="md-nav__link">
    Directory Implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-links" class="md-nav__link">
    File Links
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-system-implementation" class="md-nav__link">
    File System Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disk-layout-strategies" class="md-nav__link">
    Disk layout strategies
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inode-structure-unix-inodes" class="md-nav__link">
    Inode structure: Unix Inodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extent-based-approach" class="md-nav__link">
    Extent-based approach
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#link-based-approach" class="md-nav__link">
    Link-based approach
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ntfs" class="md-nav__link">
    NTFS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fast-file-system" class="md-nav__link">
    Fast File system
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cylinder-groups" class="md-nav__link">
    Cylinder Groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-ffs-improvements" class="md-nav__link">
    More FFS improvements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mounting-a-file-system" class="md-nav__link">
    Mounting a file system
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reading-a-file" class="md-nav__link">
    Reading a file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vfsvirtual-file-system" class="md-nav__link">
    VFS(Virtual File System)
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l5_disks/" title="Disks I/O" class="md-nav__link">
      Disks I/O
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l6_reliability/" title="Reliability and Write Optimizations" class="md-nav__link">
      Reliability and Write Optimizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l7_journaling/" title="File System Reliability" class="md-nav__link">
      File System Reliability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l8_system_call/" title="System Call" class="md-nav__link">
      System Call
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l9_threads/" title="Processes and Threads" class="md-nav__link">
      Processes and Threads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../processes/" title="Processes" class="md-nav__link">
      Processes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-14" type="checkbox" id="nav-3-14">
    
    <label class="md-nav__link" for="nav-3-14">
      Docs nfs284
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-14">
        Docs nfs284
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../docs_nfs284/" title="Welcome to MkDocs" class="md-nav__link">
      Welcome to MkDocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docs_nfs284/notes/" title="File System Considerations" class="md-nav__link">
      File System Considerations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docs_nfs284/processes/" title="Processes" class="md-nav__link">
      Processes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      NFS284
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        NFS284
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/" title="Welcome to MkDocs" class="md-nav__link">
      Welcome to MkDocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/doing_well/" title="To read" class="md-nav__link">
      To read
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/food_safety/" title="Week 4: Food Safety" class="md-nav__link">
      Week 4: Food Safety
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/general_lessons/" title="General Lessons" class="md-nav__link">
      General Lessons
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/midterm_prep/" title="Midterm preparation" class="md-nav__link">
      Midterm preparation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week5_carbohydrates/" title="Week 5: Carbohydrates" class="md-nav__link">
      Week 5: Carbohydrates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_1_nutrition_guidelines/" title="Chapter 2: Nutrition Guidelines" class="md-nav__link">
      Chapter 2: Nutrition Guidelines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_1_readings/" title="Focus on Phytochemicals" class="md-nav__link">
      Focus on Phytochemicals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_2_food_guide/" title="Canada's Food Guide" class="md-nav__link">
      Canada's Food Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_2_food_labels/" title="Food Labels(PP): *How to read and Understand Food labels*" class="md-nav__link">
      Food Labels(PP): *How to read and Understand Food labels*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_3_nutrition_research/" title="Week 3: Nutrition Reasearch" class="md-nav__link">
      Week 3: Nutrition Reasearch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_4_food_assessment/" title="Week 4: Food Intake Assessment" class="md-nav__link">
      Week 4: Food Intake Assessment
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#top-requirements-for-an-os" class="md-nav__link">
    Top requirements for an OS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-systems" class="md-nav__link">
    File Systems
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-operations" class="md-nav__link">
    File Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directories" class="md-nav__link">
    Directories
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#directory-structure" class="md-nav__link">
    Directory Structure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#directory-implementation" class="md-nav__link">
    Directory Implementation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-links" class="md-nav__link">
    File Links
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-system-implementation" class="md-nav__link">
    File System Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disk-layout-strategies" class="md-nav__link">
    Disk layout strategies
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inode-structure-unix-inodes" class="md-nav__link">
    Inode structure: Unix Inodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extent-based-approach" class="md-nav__link">
    Extent-based approach
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#link-based-approach" class="md-nav__link">
    Link-based approach
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ntfs" class="md-nav__link">
    NTFS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fast-file-system" class="md-nav__link">
    Fast File system
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cylinder-groups" class="md-nav__link">
    Cylinder Groups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-ffs-improvements" class="md-nav__link">
    More FFS improvements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mounting-a-file-system" class="md-nav__link">
    Mounting a file system
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reading-a-file" class="md-nav__link">
    Reading a file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vfsvirtual-file-system" class="md-nav__link">
    VFS(Virtual File System)
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/nicolae-stroncea/notes/tree/master/docs/CSC369/l2_l3_l4_files.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="files-and-file-systems">Files and File Systems</h1>
<h2 id="top-requirements-for-an-os">Top requirements for an OS</h2>
<p><strong>Virtualization</strong>:</p>
<ul>
<li>
<p>present physical resources as a more general, easy-to-use form of itself</p>
</li>
<li>
<p>present illusion of multiple resources where only a couple exist. For example, you can have only 1 core, but you can create 'as many processes as you want' to run them at the same time.</p>
</li>
<li>
<p><font color="blue">Files and directories abstract away the hard drive</font></p>
</li>
</ul>
<p><strong>Concurrency</strong></p>
<ul>
<li>Coordinate multiple parallel activities to ensure corectness</li>
</ul>
<p><strong>Persistence</strong></p>
<ul>
<li>
<p>Need to persist data. Data needs to survive crash.</p>
</li>
<li>
<p><font color="blue">File systems control how and when data is transferred to persistent storage</font>.</p>
</li>
</ul>
<h2 id="file-systems">File Systems</h2>
<p>Requirements:</p>
<ul>
<li>
<p>Store large amounts of information</p>
</li>
<li>
<p>Information must survive crashes and termination of processes</p>
</li>
<li>
<p>Multiple processes must be able to access information concurrently</p>
</li>
</ul>
<h3 id="file-operations">File Operations</h3>
<ul>
<li>
<p>Creating a file</p>
</li>
<li>
<p>Deleting a file</p>
</li>
<li>
<p>Writing to file</p>
</li>
<li>
<p>Reading to file</p>
</li>
<li>
<p>Moving a file</p>
</li>
<li>
<p>Truncation and appending</p>
</li>
</ul>
<h3 id="directories">Directories</h3>
<ul>
<li>
<p><strong>For user</strong>: convenient way to <u>organize files</u></p>
</li>
<li>
<p><strong>For OS</strong>: convenient <u>naming interface</u></p>
</li>
</ul>
<h4 id="directory-structure">Directory Structure</h4>
<ul>
<li>
<p>A directory isa  list of entries <name, associated metadata>. Associated data can be(size, protection, user access, location, etc)</p>
</li>
<li>
<p>Unordered list of entries</p>
</li>
<li>
<p><u>Directories are implemented as a file</u>, which means you need to manage only one kind of secondary storage</p>
</li>
</ul>
<h4 id="directory-implementation">Directory Implementation</h4>
<ul>
<li>Acyclic-graph directories: imeplmenetned in Unix: same file or directory can be in 2 different directories. DIfferent from tree-structured which may not have cycles.</li>
</ul>
<p><img alt="" src="../directory_implementations.png" /></p>
<ul>
<li>
<p>Implementation:</p>
</li>
<li>
<p><strong>List</strong>: requires linear search to find entries, easy to implement but slow to execute</p>
</li>
<li>
<p><strong>Hash table</strong>: take space, faster.</p>
</li>
</ul>
<h3 id="file-links">File Links</h3>
<ul>
<li>Hard links:</li>
<li>directory entry refers to "true path" to the file</li>
<li>Each file has a count of how many references it has. if you delete the entry, you check if the hard links is equal to 1(i.e this directory is only one pointing to it), and if yes, you actually delete the file at that path. Otherwise you just delete the current reference to it from your directory but leave the file intact since there are other references to it. In normal cases, like editing a file, you're editing the file at the true path so all references to it will point to the updated file</li>
<li>Soft links</li>
<li>with a soft link, you <strong>refer to a file</strong> which holds the true path of the linked file. The advantage of this is that you can work across file systems. Disadvantage is that if you delete the file, link remains in place. Another disadvantage is that you don't actually delete the file, you delete the soft link to it.</li>
</ul>
<h2 id="file-system-implementation">File System Implementation</h2>
<ul>
<li>
<p>File systems use <u>blocks(4Kb) to store data</u>. If our disk is 64 kb, we have 16 blocks.</p>
</li>
<li>
<p><u>Superblock/master block</u> <mark>determines location of root directory</mark></p>
</li>
<li>
<p>superblock always at well-known disk location(might be in dirst block)</p>
</li>
<li>
<p>sometimes replicated for reliability</p>
</li>
<li>
<p>Includes other important information about file system(how many inodes, data blocks there are, where bitmaps and inode begin)</p>
</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">a1fs_superblock</span> <span class="p">{</span>

    <span class="c1">// basic file system info: type of file system, size of file system, number of inodes</span>
    <span class="cm">/** Must match A1FS_MAGIC. */</span>
    <span class="kt">uint64_t</span> <span class="n">magic</span><span class="p">;</span>
    <span class="kt">uint64_t</span> <span class="n">size</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">s_inode_size</span><span class="p">;</span> 

    <span class="c1">// number of inodes, blocks + free inodes and free blocks</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">s_inodes_count</span><span class="p">;</span>     
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">s_blocks_count</span><span class="p">;</span>      
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">s_free_blocks_count</span><span class="p">;</span> 
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">s_free_inodes_count</span><span class="p">;</span>
    <span class="c1">// Location of bitmaps and tables</span>
    <span class="n">a1fs_extent</span> <span class="n">data_blocks_extent</span><span class="p">;</span>      
    <span class="n">a1fs_extent</span> <span class="n">block_bitmap_extent</span><span class="p">;</span>      
    <span class="n">a1fs_extent</span> <span class="n">inode_bitmap_extent</span><span class="p">;</span>     
    <span class="n">a1fs_extent</span> <span class="n">inode_table_extent</span><span class="p">;</span>     

<span class="p">}</span> <span class="n">a1fs_superblock</span><span class="p">;</span>
</pre></div>

<ul>
<li>
<p>We have <u>bitmaps</u> which determine which blocks are free, one bit per block on disk. They can be <em>cached in memory for performance</em></p>
</li>
<li>
<p><font color="blue">In ext2, we have a bitmap for inodes, and a bitmap for data blocks</font></p>
</li>
<li>
<p><u>Inode table</u> stored in 1+ blocks. Inode table</p>
</li>
<li>
<p>Remaining blocks used to store files and directories</p>
</li>
</ul>
<h3 id="disk-layout-strategies">Disk layout strategies</h3>
<p>Files often span multiple blocks, since they are greater than 4Kb(or whatever size of the block is). Here's how to find all blocks of a file:</p>
<ol>
<li><u>Contiguous</u> allocation:</li>
</ol>
<p><strong>Advantages</strong>: fast, simplifies directory access. </p>
<p><strong>Disadvantages</strong>: inflexible, causes external fragmentation</p>
<ol>
<li><u>Links</u></li>
</ol>
<p><strong>Advantages</strong>: each block points to the next, directory points to the firss. Good for sequentia/continuousl access</p>
<p><strong>Disadvantages</strong>: terrible for random access</p>
<ol>
<li><u>Indexed structure/inode</u>: index block contains pointers to many other blocks.</li>
</ol>
<p><strong>Advantages</strong>: handles random access well, b/c has pointers to all blocks. Pretty good for sequential</p>
<p><img alt="Data block allocation strategies" src="../strategies.png" /></p>
<h4 id="inode-structure-unix-inodes">Inode structure: Unix Inodes</h4>
<ul>
<li>
<p>All file metadata is stored inside an inode</p>
</li>
<li>
<p>Unix directories map file names to inode: <file_name, inode_number></p>
</li>
<li>
<p>Each inode contains 15 block pointer:</p>
</li>
<li>
<p>12 are direct block pointers(disk addresses of first 12 data block pointers)</p>
</li>
<li>
<p>13th is single indirect block pointer: points to block containing direct block pointers</p>
</li>
<li>
<p>14th is a double indirect block pointer: points to block contiaining addresses of single indirect blocks</p>
</li>
<li>
<p>15th is a triple indirect block pointer.</p>
</li>
<li>
<p>Total size will be: <span><span class="MathJax_Preview">4Kb*(12+ 1024+1024^2 + 1024^3) \approx 4Tb</span><script type="math/tex">4Kb*(12+ 1024+1024^2 + 1024^3) \approx 4Tb</script></span></p>
</li>
<li>
<p>Advantages of imbalanced tree like this are:</p>
<ul>
<li>
<p>most files are small(<span><span class="MathJax_Preview">\approx 2Kb</span><script type="math/tex">\approx 2Kb</script></span>)</p>
</li>
<li>
<p>Files are usually accessed sequentially</p>
</li>
<li>
<p>DIrectories are typically small(20-)</p>
</li>
</ul>
<p>Therefore, most of them will fit inside of the direct blocks, which results in a very fast sequential + random access. Once file becomes larger, than need to use indirect blocks.</p>
</li>
</ul>
<p><img alt="" src="../inode.png" /></p>
<h4 id="extent-based-approach">Extent-based approach</h4>
<div class="codehilite"><pre><span></span><span class="cm">/** Extent - a contiguous range of blocks. */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">extent</span> <span class="p">{</span>
    <span class="cm">/** Starting block of the extent. */</span>
    <span class="kt">int</span> <span class="n">start</span><span class="p">;</span>
    <span class="cm">/** Number of blocks in the extent. */</span>
    <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<ul>
<li>
<p><strong>Advantages</strong>: uses smaller amoutn of metadata per file, <u>file allocation is more compact</u></p>
</li>
<li>
<p><strong>Disadvantages</strong>: <u>less flexible than pointer-based</u> approach, but still a  lot more flexible compared to contiguous allocation. This sort of does contiguous allocation but on a much smaller scale, where it's blocks of contiguously allocated files.</p>
</li>
<li>
<p><strong>Used by</strong>: ext4, HFS+, NTFS, XFS</p>
</li>
</ul>
<h4 id="link-based-approach">Link-based approach</h4>
<ul>
<li>
<p>FAT file system ,sued by WIndoes before NTFS</p>
</li>
<li>
<p>Instead of pointer to all blocks you have a table where the inode just has one pointer to first data block o the file, then first block points to second block etc</p>
</li>
</ul>
<p><strong>Disadvantages</strong>: very bad random access, or accessing last blocks of file since you need to move through all data blocks first.</p>
<h5 id="ntfs">NTFS</h5>
<ul>
<li>Each <strong>volume(partition)</strong> is a linear sequence of blocks.</li>
</ul>
<p><strong>Master File Table</strong>:</p>
<ul>
<li>
<p><strong>Each volume has a </strong>Master File Table**(MFT)</p>
</li>
<li>
<p>MFT is full of 1 kb <strong>Records</strong>(MFR). </p>
</li>
</ul>
<p><strong>Records</strong>(they're similar to inodes but more flexible):</p>
<ul>
<li>
<p><u>1 or more records per file/directory</u> .</p>
</li>
<li>
<p>MFT records are <u>variable length</u></p>
</li>
<li>
<p>Long attributes can be stored externally, and a pointer kept in MFT record. Otherwise MFT record prefers to keep data inside of it(so it will store dentries inside of an MFT record as well as the actual data inside a small file). </p>
</li>
<li>
<p>If data won't fit inside an MFT record, NTFS will to allocate files in <strong>extents/runs of consecutive blocks</strong> and give pointers towards them.. </p>
</li>
<li>
<p>Records contain a lot of metadata(key value pairs), which allow for implementation of extra features: compresion, different file types.</p>
</li>
</ul>
<h4 id="fast-file-system">Fast File system</h4>
<blockquote>
<p>meant for hard disk-based environments</p>
</blockquote>
<h5 id="cylinder-groups">Cylinder Groups</h5>
<ul>
<li>
<p>Disk partitioned into groups of cylinders(bitmap + inodes + data blocks all in the same group)</p>
</li>
<li>
<p>Data <u>blocks in same file allocated in same cylinder group</u> which decreases seeking when reading a file</p>
</li>
<li>
<p>Files in<u> same directory allocated in same cylinder group</u> which decreases seeking when finding a file in a path, because folders are also considered files so we want to stay within the same cylinder group preferably.</p>
</li>
<li>
<p><mark>Inodes for files allocated in same cylinder group as file data blocks</mark> which decreases seeking</p>
</li>
</ul>
<p><img alt="" src="../cylinder_group.png" /></p>
<h5 id="more-ffs-improvements">More FFS improvements</h5>
<ul>
<li>
<p>Use larger blocks(4K) with fragments(1K pieces) instead of small blocks(1K)</p>
</li>
<li>
<p><mark>Small block size leads to a small max file size + low bandwidth utilization.</mark></p>
</li>
</ul>
<h2 id="mounting-a-file-system">Mounting a file system</h2>
<ol>
<li>
<p>OS reads the superblock</p>
</li>
<li>
<p>OS identifies type of FS + other parameters</p>
</li>
<li>
<p>OS attaches the volume to the file system tree</p>
</li>
</ol>
<h2 id="reading-a-file">Reading a file</h2>
<ol>
<li>
<p>Find the inode number from the dentry(directory entry)</p>
</li>
<li>
<p>Find the inode inside of the inode table. e.g: if inode is inode #32 then find it at:<span><span class="MathJax_Preview">4kb(blocksize) \times 3 + 128b (size\; of\; inode) * 32</span><script type="math/tex">4kb(blocksize) \times 3 + 128b (size\; of\; inode) * 32</script></span></p>
</li>
<li>
<p>Once you have the inode, inode has pointer to all of its data blocks, so do the same strategy to get to the data blocks and then read them.</p>
</li>
</ol>
<p><strong>Say you want to open file</strong> <code class="codehilite"><span class="o">/</span><span class="n">one</span><span class="o">/</span><span class="n">two</span><span class="o">/</span><span class="n">three</span></code>:</p>
<ol>
<li>
<p>Master block for the location of inode for “/”</p>
</li>
<li>
<p>Directory block for “/” - search for “one”</p>
</li>
<li>
<p>Inode block containing inode for “one”</p>
</li>
<li>
<p>Directory block for “one” - search for “two”</p>
</li>
<li>
<p>Inode block containing inode for “two”</p>
</li>
<li>
<p>Directory block for “two” - search for “three”</p>
</li>
<li>
<p>Inode block for “three", open()</p>
</li>
</ol>
<h2 id="vfsvirtual-file-system">VFS(Virtual File System)</h2>
<ul>
<li>
<p>Works as an <u>Abstraction file system interface</u>. User-level programmer interacts with file systems through general system calls, without worrying about which system call it is.</p>
</li>
<li>
<p>Helps OS support file system and programmers not code towards a specific file system</p>
</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../l14_deadlocks/" title="Deadlock" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Deadlock
              </span>
            </div>
          </a>
        
        
          <a href="../l5_disks/" title="Disks I/O" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Disks I/O
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>
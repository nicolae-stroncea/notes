



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Synchronization - UofT courses</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#7e57c2">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-purple" data-md-color-accent="">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#synchronization" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="UofT courses" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              UofT courses
            </span>
            <span class="md-header-nav__topic">
              
                Synchronization
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/nicolae-stroncea/notes/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="UofT courses" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    UofT courses
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/nicolae-stroncea/notes/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      CSC309
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        CSC309
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC309/" title="Communication and Protocols" class="md-nav__link">
      Communication and Protocols
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC309/http/" title="The World Wide Web and HTTP" class="md-nav__link">
      The World Wide Web and HTTP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC309/lec3/" title="Lec3" class="md-nav__link">
      Lec3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC309/midterm_preparation/" title="Midterm Preparation" class="md-nav__link">
      Midterm Preparation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      CSC343
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        CSC343
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/" title="Welcome to MkDocs" class="md-nav__link">
      Welcome to MkDocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/ddl/" title="Data Definition Language(DDL)" class="md-nav__link">
      Data Definition Language(DDL)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/relational_algebra/" title="Relational Algebra" class="md-nav__link">
      Relational Algebra
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/schema/" title="Schemas" class="md-nav__link">
      Schemas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/sql_dml_1/" title="Data Manipulation Language(DML)" class="md-nav__link">
      Data Manipulation Language(DML)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/sql_dml_2/" title="Outer Joins" class="md-nav__link">
      Outer Joins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSC343/subqueries/" title="Subqueries" class="md-nav__link">
      Subqueries
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      CSC369
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        CSC369
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Index" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Synchronization
      </label>
    
    <a href="./" title="Synchronization" class="md-nav__link md-nav__link--active">
      Synchronization
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#types-of-synchronization" class="md-nav__link">
    Types of synchronization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#critical-sectioncs-requirements" class="md-nav__link">
    Critical Section(CS) requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-synchronization-attempt" class="md-nav__link">
    First Synchronization attempt:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-synchronization-attempt" class="md-nav__link">
    Second Synchronization attempt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronization-petersons-algorithm" class="md-nav__link">
    Synchronization: Peterson's Algorithm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronization-lamports-bakery-algorithm" class="md-nav__link">
    Synchronization: Lamport's Bakery algorithm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronization-hardware-vs-software" class="md-nav__link">
    Synchronization Hardware vs Software
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disabling-interrupts" class="md-nav__link">
    Disabling interrupts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#high-level-synchronization-types" class="md-nav__link">
    High Level Synchronization types
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l11_locks/" title="Locks" class="md-nav__link">
      Locks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l12_conditional_variables/" title="Conditional Variables" class="md-nav__link">
      Conditional Variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l13_semaphores/" title="Semaphores" class="md-nav__link">
      Semaphores
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l14_deadlocks/" title="Deadlock" class="md-nav__link">
      Deadlock
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l2_l3_l4_files/" title="Files and File Systems" class="md-nav__link">
      Files and File Systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l5_disks/" title="Disks I/O" class="md-nav__link">
      Disks I/O
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l6_reliability/" title="Reliability and Write Optimizations" class="md-nav__link">
      Reliability and Write Optimizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l7_journaling/" title="File System Reliability" class="md-nav__link">
      File System Reliability
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l8_system_call/" title="System Call" class="md-nav__link">
      System Call
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../l9_threads/" title="Processes and Threads" class="md-nav__link">
      Processes and Threads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../processes/" title="Processes" class="md-nav__link">
      Processes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-14" type="checkbox" id="nav-3-14">
    
    <label class="md-nav__link" for="nav-3-14">
      Docs nfs284
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-14">
        Docs nfs284
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../docs_nfs284/" title="Welcome to MkDocs" class="md-nav__link">
      Welcome to MkDocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docs_nfs284/notes/" title="File System Considerations" class="md-nav__link">
      File System Considerations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docs_nfs284/processes/" title="Processes" class="md-nav__link">
      Processes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      NFS284
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        NFS284
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/" title="Welcome to MkDocs" class="md-nav__link">
      Welcome to MkDocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/doing_well/" title="To read" class="md-nav__link">
      To read
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/food_safety/" title="Week 4: Food Safety" class="md-nav__link">
      Week 4: Food Safety
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/general_lessons/" title="General Lessons" class="md-nav__link">
      General Lessons
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/midterm_prep/" title="Midterm preparation" class="md-nav__link">
      Midterm preparation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week5_carbohydrates/" title="Week 5: Carbohydrates" class="md-nav__link">
      Week 5: Carbohydrates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_1_nutrition_guidelines/" title="Chapter 2: Nutrition Guidelines" class="md-nav__link">
      Chapter 2: Nutrition Guidelines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_1_readings/" title="Focus on Phytochemicals" class="md-nav__link">
      Focus on Phytochemicals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_2_food_guide/" title="Canada's Food Guide" class="md-nav__link">
      Canada's Food Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_2_food_labels/" title="Food Labels(PP): *How to read and Understand Food labels*" class="md-nav__link">
      Food Labels(PP): *How to read and Understand Food labels*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_3_nutrition_research/" title="Week 3: Nutrition Reasearch" class="md-nav__link">
      Week 3: Nutrition Reasearch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../NFS284/week_4_food_assessment/" title="Week 4: Food Intake Assessment" class="md-nav__link">
      Week 4: Food Intake Assessment
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#types-of-synchronization" class="md-nav__link">
    Types of synchronization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#critical-sectioncs-requirements" class="md-nav__link">
    Critical Section(CS) requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-synchronization-attempt" class="md-nav__link">
    First Synchronization attempt:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-synchronization-attempt" class="md-nav__link">
    Second Synchronization attempt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronization-petersons-algorithm" class="md-nav__link">
    Synchronization: Peterson's Algorithm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronization-lamports-bakery-algorithm" class="md-nav__link">
    Synchronization: Lamport's Bakery algorithm
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronization-hardware-vs-software" class="md-nav__link">
    Synchronization Hardware vs Software
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disabling-interrupts" class="md-nav__link">
    Disabling interrupts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#high-level-synchronization-types" class="md-nav__link">
    High Level Synchronization types
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/nicolae-stroncea/notes/tree/master/docs/CSC369/l10_synchronization.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="synchronization">Synchronization</h1>
<p><font color="blue">By design, threads/processes can't anticipate when they are forced to yield the CPU through a context switch.</font> Therefore, we need a way to make sure that threads share memory in a safe manner. We do that with synchronization.</p>
<h2 id="types-of-synchronization">Types of synchronization</h2>
<ol>
<li>
<p>Enforce <u>single use</u> of a shared resource, i.e only 1 thread can access a resource at the same time. This is called the <font color="red">critical section problem</font>. By ensuring only 1 thread can access the resource, that means any future thread will only access it once it is updated, so there is no case where 2 threads are modifying data at the same time. This guarantees correctness.</p>
</li>
<li>
<p>Control order of thread execution.</p>
</li>
</ol>
<h2 id="critical-sectioncs-requirements">Critical Section(CS) requirements</h2>
<p><font color="blue">Only 1 thread can access a shared resource at the same time</font>. CS has shared variables which need to be <u>synchronized</u> to maintain consistency of data varaibles.</p>
<ol>
<li><strong>Mutual exclusion</strong></li>
</ol>
<p>If one thread is in the CS, no other thread is.</p>
<ol>
<li><strong>Progress</strong></li>
</ol>
<p>If no thread is executing in the critical section and other threads are waiting outside CS, <strong>only threads trying to get into CS section can influence the choice of which thread enters next</strong>, and <strong>choice cannot be postponed indefinitely</strong>. Essentially <mark>a process not requesting Critical section should not block other processes from entering the critical section.</mark></p>
<ol>
<li><strong>No starvation</strong>(bounded waiting)</li>
</ol>
<p>Once a thread T makes a request to access CS, <em>There is a bound(a limit)</em> on number of times that other threads are allowed to enter CS before thread T is granted access, i.e <strong>eventually a thread which wants to access CS <u>must</u> be allowed to access it.</strong></p>
<h3 id="first-synchronization-attempt">First Synchronization attempt:</h3>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">my_work</span><span class="p">(</span><span class="kt">id_t</span> <span class="n">id</span><span class="p">){</span>
    <span class="cm">/* XXXXXXX   entry section   XXXXXXX */</span>
    <span class="c1">// repeat indefinitely until it&#39;s your turn,</span>
    <span class="c1">// i.e turn becomes your id*/</span>
    <span class="k">while</span><span class="p">(</span><span class="n">turn</span> <span class="o">!=</span> <span class="n">id</span><span class="p">);</span> 
        <span class="cm">/* XXXXXXX   Critical section   XXXXXXX */</span>
        <span class="c1">// now we&#39;re in critical section, only the thread with the right ID(and ids are unique) can access it</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;now you&#39;re in critical section&quot;</span><span class="p">);</span>

        <span class="cm">/* XXXXXXX   Exiting critical section   XXXXXXX */</span>
        <span class="n">turn</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">id</span><span class="p">;</span> <span class="c1">//change the id</span>
        <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<ul>
<li>The above satisfies <strong>mutual exclusion</strong>: only 1 thread can access CS</li>
<li>Above does not satisfy <strong>progress</strong>: if turn = 0, T1 may not enter even though it has gotten there before T0(or even if T0 is in another section), therefore it's not influencing the choice of which thread enters next, as something else has. <mark>If we don't have progress, then we have starvation</mark></li>
</ul>
<h3 id="second-synchronization-attempt">Second Synchronization attempt</h3>
<p><img alt="" src="../critical_section_1.png" /></p>
<p><font color="red"><mark>Threads can yield execution at ANY TIME <strong>after they finish current instruction. A thread cannot switch half-way through executing an instruction.</strong></mark> Here, one of them executes condition from while loop, and then GIVES UP CONTROL, at which point when control comes back to it, it's too late to lock the CS.</font> Therefore in this case it <strong>does not satisfy mutual exclusion</strong>, since multiple threads can be in CS at the same time</p>
<p><img alt="" src="../critical_section_2.png" /></p>
<h3 id="synchronization-petersons-algorithm">Synchronization: Peterson's Algorithm</h3>
<div class="codehilite"><pre><span></span><span class="c1">//NOTE: loser and flags are both global variables, so both threads have access to them and can modify the global version(and the changes propagate)</span>
<span class="kt">int</span> <span class="n">loser</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">flags</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="cm">/* Show &quot;interest&quot; in CS, are both initially 0, aka false*/</span>

<span class="kt">void</span> <span class="nf">my_work</span><span class="p">(</span><span class="kt">id_t</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// id will be 0 or 1 depending on which id it is</span>
    <span class="c1">//...</span>
    <span class="n">flag</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// entry section</span>
    <span class="c1">// by setting loser to itself, thread is being polite and allows other threads to enter. Assume this thread is the last one to arrive, so it sets loser to itself and the other thread can now move into critical section.</span>
    <span class="n">loser</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="c1">// Entrance is granted for T0 if T1 does not want to enter(flag[1-id] is False) OR if T1 gave priority to T0 by setting loser = 1.</span>
    <span class="k">while</span><span class="p">(</span><span class="n">loser</span> <span class="o">==</span> <span class="n">id</span> <span class="o">&amp;&amp;</span> <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">id</span><span class="p">]);</span>
    <span class="cm">/* Critical section */</span>     
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;in critical section now&quot;</span><span class="p">);</span>
    <span class="cm">/*Exit section */</span>
    <span class="n">flag</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>          
    <span class="p">}</span>    
<span class="p">}</span>
</pre></div>

<ul>
<li>
<p>Assume 1 thread arrives but not the other. In that case flag for other will be set to False so this thread can go ahead(therefore progress is satisfied-only the threads waiting for CS can get in).</p>
</li>
<li>
<p>If multiple threads want to access something at the same time</p>
</li>
<li>
<p><font color="blue">Final value of turn/loser determines which of the 2 processes is allowed to enter its critical section first</font>, and because turn doesn't change it guarantees mutual exclusion where other thread cannot enter, UNTIL it sets its flag to false.</p>
</li>
<li>
<p>Alg. can be extended to N threads</p>
</li>
</ul>
<h3 id="synchronization-lamports-bakery-algorithm">Synchronization: Lamport's Bakery algorithm</h3>
<ul>
<li>
<p>Upon entering each customer/thread gets a #</p>
</li>
<li>
<p>The thread with lowest number is served next</p>
</li>
<li>
<p>There's no guarantee that 2 threads don't get the same number. In the case of a tie, thread with lowest id is served first. Thread ids are unique and totally ordered.</p>
</li>
</ul>
<h3 id="synchronization-hardware-vs-software">Synchronization Hardware vs Software</h3>
<p>Peterson's and Lamport's bakery algorithm show that <u>synchronization can be implemented in software</u>. However, <strong>hardware instructions make it easier and more efficient</strong> to build up higher-level abstractions for synchronization.</p>
<h4 id="disabling-interrupts">Disabling interrupts</h4>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">lock</span><span class="p">(){</span>
    <span class="n">disable_interrupts</span><span class="p">()</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">unlock</span><span class="p">(){</span>
    <span class="n">enable_interrupts</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>

<p>This is one solution on hardware level to create locks to enable synchronization and <strong>ensure mutual exclusion</strong>.</p>
<p>From <a href="http://www.cs.nott.ac.uk/~pszgxk/courses/g53ops/Processes/proc06-mutexbusy.html">Operating Systems</a>:  Perhaps the most obvious way of achieving mutual exclusion is to allow a process  to disable interrupts before it enters its critical section and then enable interrupts after it leaves its critical section.  </p>
<p>By disabling interrupts the CPU will be unable to switch processes. This guarantees 
that the process can use the shared variable without another process accessing 
it. But, disabling interrupts, is a major undertaking.</p>
<p><strong>Disadvantages</strong>:</p>
<ul>
<li>
<p>The computer will not be able to service interrupts for, maybe, a long time, depending on what a process is doing in a critical section.</p>
</li>
<li>
<p>The process may forget to neable interrupts,  which will effectively crash the computer.</p>
</li>
<li>
<p>On multiprocessor systems other processors can still access it, this only stops context switches between threads not between processes.</p>
</li>
</ul>
<h2 id="high-level-synchronization-types">High Level Synchronization types</h2>
<ol>
<li>
<p><strong>Locks</strong>: good for <u>protecting access to critical sections</u></p>
</li>
<li>
<p><strong>Condition variables</strong>(Condition can be any boolean expression): They <u>wait for a condition to become true</u></p>
</li>
<li>
<p><strong>Semaphores</strong>:</p>
</li>
<li>
<p>Basic, <u>easy to understand</u></p>
</li>
<li>
<p>Good for some race conditions where <u>you can set the order</u> in which threads will execute. <strong>race condition</strong>: condition where multiple threads access Critical Section and both try to <u>update</u> a shared veriable. <em>Note</em> that reading is not considered updating since it doesn't change the value.</p>
</li>
<li>
<p>Not always the right abstraction</p>
</li>
<li>
<p>Monitors: high-level, ideally have language support( Java)</p>
</li>
</ol>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="Index" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Index
              </span>
            </div>
          </a>
        
        
          <a href="../l11_locks/" title="Locks" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Locks
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
  </body>
</html>